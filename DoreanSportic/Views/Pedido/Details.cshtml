@model DoreanSportic.Application.DTOs.PedidoDTO
@using System.Security.Claims
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = "Details";
    var usuarioIdClaim = User.FindFirstValue(ClaimTypes.NameIdentifier);
}

<div style="margin-left:10%; margin-right:15%">
    <div class="py-4">
        <a class="btn btn-sm btn-outline bg-[#006400] text-white w-50" asp-action="Index">
            @(Localizer["Volver al listado"])
        </a>
    </div>

    <div class="mb-4 max-w-4xl mx-auto p-6 bg-white text-slate-500 shadow-md rounded mt-10 border rounded font-sans">

        <!-- Header de la “factura” (marca/empresa) -->
        <div class="border-b pb-8 mb-8 w-full">
            <div class="flex justify-between items-start">

                <!-- Información de la empresa -->
                <div class="flex-1 text-left p-2">
                    <img src="@Url.Content("~/Assets/DoreanSporticLogo.png")" asp-append-version="true"
                         alt="Company Logo" class="h-10 w-25 mr-4">
                    <p class="text-sm text-slate-500"><b>Dorean Sportic S.A.</b></p>
                    <p class="text-sm text-slate-500"><b>@Localizer["Dirección"]:</b> San Juan, Santa Bárbara, Heredia, Costa Rica.</p>
                    <p class="text-sm text-slate-500"><b>@Localizer["Teléfono"]:</b> 72969719</p>
                    <p class="text-sm text-slate-500"><b>@Localizer["Correo electrónico"]:</b> doreansportic@gmail.com</p>
                </div>

                <!-- Fecha/Hora de emisión -->
                <div class="text-right self-start" style="margin-top: 11%; padding-right: 5%">
                    <b>@Localizer["Fecha del pedido"]:</b> @Model.FechaPedido.ToString("dd/MM/yyyy")
                    <div class="text-xs text-slate-400 mb-1">
                        <b>@Localizer["Hora de emisión"]:</b> @Model.FechaPedido.ToString("HH:mm:ss")<br />
                        <p class="italic" style="font-size: 12px">* @Localizer["Formato de 24 horas"] *</p>
                    </div>
                    <div>
                        <b>@Localizer["Estado de pago"]:</b>
                        <span id="pedido-estado">@Model.EstadoPago</span>
                    </div>
                </div>
            </div>
        </div>


        <!-- Encabezado tipo factura -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 p-2">
            <!-- Columna izquierda: selector de usuario y resumen del cliente -->
            <div class="space-y-3">
                <p class="text-sm text-slate-500">
                    <b>@(Localizer["Pedido"]) #:</b> <u>@Model.Id</u>
                </p>

                <label class="text-slate-700 mb-2"><b>@Localizer["Cliente"]:</b> @User.Identity?.Name</label>

                <br />

                <!-- Contenedor de selector de cliente + información detallada de este -->
                <div class="flex flex-row gap-4 mt-4 p-2">

                    <!-- Radios: qué mostrar -->
                    <div class="flex flex-col gap-4" style="padding-right: 10%; padding-top: 1%">
                        <!-- Radio button Correo-->
                        <label class="label cursor-pointer gap-2">
                            <input type="radio" name="mostrar-detalle" value="email" class="radio radio-sm" checked>
                            <span class="label-text">@Localizer["Correo electrónico"]</span>
                        </label>

                        <!-- Radio button Telefono-->
                        <label class="label cursor-pointer gap-2">
                            <input type="radio" name="mostrar-detalle" value="telefono" class="radio radio-sm">
                            <span class="label-text">@Localizer["Teléfono"]</span>
                        </label>
                    </div>

                    <!-- Resumen NO EDITABLE del cliente -->
                    <div id="cliente-resumen" class="p-3 rounded border mt-2 w-100">
                        <div class="mb-1">
                            <b>@Localizer["INFORMACIÓN DEL CLIENTE"]</b>
                        </div>
                        <div>
                            <b>@Localizer["Cliente"]:</b>
                            <span id="cliente-nombre">
                                @User.Identity?.Name
                            </span>
                        </div>

                        <!-- Área dinámica (se rellena según selección en el radio) -->
                        <div class="mt-1">
                            <b id="cliente-detalle-label">@Localizer["Correo"]:</b>
                            <span id="cliente-detalle-valor">
                                @Model.IdClienteNavigation?.Email
                            </span>
                        </div>
                    </div>
                </div>

            </div>


            <div class="space-y-3">
                <label class="font-semibold text-slate-700">
                    <b>@Localizer["Dirección de envío"]</b>
                </label>

                <!-- Selects en cascada -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">

                    <!-- Provincia-->
                    <select id="sel-provincia" class="select select-bordered w-full">
                        <option value="">@Localizer["Provincia"]</option>
                    </select>

                    <!-- Cantón -->
                    <select id="sel-canton" class="select select-bordered w-full" disabled>
                        <option value="">@Localizer["Cantón"]</option>
                    </select>

                    <!-- Distrito -->
                    <select id="sel-distrito" class="select select-bordered w-full" disabled>
                        <option value="">@Localizer["Distrito"]</option>
                    </select>
                
                </div>

                <!-- Otras señas -->
                <label for="otras-senas" class="font-semibold text-slate-700">
                    <b>@Localizer["Otras señas"]</b>
                </label>
                <textarea id="otras-senas" class="textarea textarea-bordered w-full" rows="3"
                          placeholder="@Localizer["Ej: 200m norte de ..."]"></textarea>

                <!-- Input oculto para armar direccion de envío -->
                <input type="hidden" id="direccion-compuesta" />
            </div>
        </div>

        <!-- Detalle del pedido (tabla renderizada vía vista parcial) -->
        <div id="tabla-detalles">
            <p class="text-sm">@(Localizer["Cargando detalles del pedido"])</p>
        </div>
    </div>
</div>


<!-- Guardar el id de usuario/cliente en un input oculto -->
<input type="hidden"
       id="cliente-userid"
       value="@usuarioIdClaim"
       data-pedido-id="@Model.Id" />

<form id="pedido-encabezado-form">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        window.PedidoConfig = {
          pedidoId: @Model.Id,
          localizer: {
            "Encabezado guardado": "@Localizer["Encabezado guardado"]",
            "No fue posible guardar": "@Localizer["No fue posible guardar"]",
            "Error inesperado": "@Localizer["Error inesperado"]"
          }
        };
    </script>
    <script src="~/js/Pedido.js" asp-append-version="true"></script>

}