@model DoreanSportic.Web.ViewModels.RegistroViewModel
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = @Localizer["Editar usuario"];
    Layout = "_LayoutLogin";
}

<!-- Para seleccionar el idioma de la aplicación -->
@{
    // Obtener idioma/cultura actual que corre la aplicación
    var currentCulture = System.Globalization.CultureInfo.CurrentUICulture.Name;

    // Generar las opciones del formulario (options) como cadenas String ya que Razor no permite agregarlas como
    // atributos en las opciones del formulario. Luego en el formulario se usa Html.Raw para inyectar texto HTML puro
    // el cual Razor no ve como un tag helper (lo que provoca un error de no poder insertar código C# dentro del atributo del tag helper)
    var optionEs = $"<option value=\"es-CR\"{(currentCulture.StartsWith("es") ? " selected" : "")}>ES</option>";
    var optionEn = $"<option value=\"en-US\"{(currentCulture.StartsWith("en") ? " selected" : "")}>EN</option>";
}

<nav class="navbar bg-transparent absolute top-0 left-0 right-0 z-50">
    <div class="flex-1"></div>
    <div class="navbar-end pr-4 w-full">
        <form id="lang-form"
              action="@Url.Action("SetLanguage","Language")"
              method="post"
              class="flex items-center gap-2">
            <div class="flex items-center gap-2" style="width: 150px ; padding-right: 10px">
                <span class="text-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" class="inline h-5 w-5 text-black" viewBox="0 0 24 24" stroke="currentColor">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" />
                        <path d="M2 12h20M12 2a15.3 15.3 0 010 20M12 2a15.3 15.3 0 000 20" stroke="currentColor" stroke-width="2" fill="none" />
                    </svg>
                </span>
                <select name="culture"
                        onchange="this.form.submit();"
                        class="select select-sm bg-black text-white text-base-content"
                        style="border:none">
                    @Html.Raw(optionEs)
                    @Html.Raw(optionEn)
                </select>
            </div>
            <input type="hidden" name="returnUrl" value="@Context.Request.Path" />
        </form>
    </div>
</nav>

<!-- ===================== Contenido principal ===================== -->

<div class="hero bg-base-200 min-h-screen w-100">
    <div class="hero-content flex-col lg:flex-row w-full shadow-lg p-3">

        <div class="text-center lg:text-left max-w-xl">
            <h1 class="text-5xl font-bold" style="font-size: 25px">@Localizer["Editar usuario"]</h1>
            <p class="py-6 font-bold">
                @Localizer["Actualiza los datos del usuario. El nombre de usuario no se puede modificar desde esta vista."]
            </p>
        </div>

        <div class="card bg-base-100 w-full max-w-3xl shrink-0 shadow-2xl">
            <div class="card-body">

                <div asp-validation-summary="ModelOnly" class="text-sm italic" style="color:red; font-size: small"></div>

                <!-- Opción A: si usas la función manejarSubmitUsuarioEdit -->
                <form id="formEditUsuario"
                      asp-action="Edit"
                      asp-controller="Usuario"
                      method="post"
                      asp-antiforgery="true"
                      onsubmit="return manejarSubmitUsuarioEdit(event)">
                    <!-- Opción B (recomendada si usas delegación de submit en Dashboard.js):
                         Quita el atributo onsubmit de arriba y deja que el listener global maneje el submit -->
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="IdCliente" />

                    <fieldset class="fieldset">
                        <!-- Nombre + Apellido -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="label mb-1" asp-for="Nombre">@Localizer["Nombre"]</label>
                                <input class="input input-bordered" asp-for="Nombre" style="border-color:black" />
                                <span class="text-error text-sm italic" asp-validation-for="Nombre" style="color:red; font-size: small"></span>
                            </div>
                            <div>
                                <label class="label mb-1" asp-for="Apellido">@Localizer["Apellido"]</label>
                                <input class="input input-bordered" asp-for="Apellido" style="border-color:black" />
                                <span class="text-error text-sm italic" asp-validation-for="Apellido" style="color:red; font-size: small"></span>
                            </div>
                        </div>

                        <!-- Email -->
                        <label class="label" asp-for="Email">@Localizer["Correo electrónico"]</label>
                        <input class="input input-bordered" asp-for="Email" type="email" style="border-color:black" />
                        <span class="text-error text-sm italic" asp-validation-for="Email" style="color:red; font-size: small"></span>

                        <!-- Teléfono + Sexo -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="label mb-1" asp-for="Telefono">@Localizer["Teléfono (opcional)"]</label>
                                <input class="input input-bordered" asp-for="Telefono" style="border-color:black" />
                                <span class="text-error text-sm italic" asp-validation-for="Telefono" style="color:red; font-size: small"></span>
                            </div>
                            <div>
                                <label class="label mb-1" asp-for="IdSexo">@Localizer["Sexo (opcional)"]</label>
                                <select class="select select-bordered" asp-for="IdSexo" asp-items="Model.Sexos" style="border-color:black">
                                    <option value="3">-- @Localizer["Seleccione"] --</option>
                                </select>
                            </div>
                        </div>

                        <!-- Usuario (solo lectura) -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="label" asp-for="UserName">@Localizer["Usuario"]</label>
                                <input class="input input-bordered" asp-for="UserName" style="border-color:black" readonly />
                                <span class="text-error text-sm italic" asp-validation-for="UserName" style="color:red; font-size: small"></span>
                            </div>
                        </div>

                        <!-- SIN contraseña: esta vista no cambia la contraseña -->

                        <!-- Botón -->
                        <button class="btn bg-[#004AAD] text-white mt-4 w-full" type="submit">
                            @Localizer["Actualizar usuario"]
                        </button>
                    </fieldset>
                </form>

                <hr />

                <p class="text-sm">
                    <a class="link link-hover font-semibold" href="javascript:void(0);" onclick="cargarVista('/Usuario/IndexAdmin')">
                        @Localizer["Volver al listado"]
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Mensajes para JS (edición) -->
<div id="mensajes-internacionalizados-usuario-edit" class="hidden"
     data-ok='@Localizer["¡Usuario actualizado correctamente!"]'
     data-errorform='@Localizer["Corrige los errores del formulario"]'
     data-errorinesperado='@Localizer["Error inesperado"]'
     data-usuarioLong='@Localizer["El usuario debe tener entre {{0}} y {{1}} caracteres"]'
     data-usuarioForm='@Localizer["Solo letras, números, punto, guion y guion bajo"]'
     data-email='@Localizer["Correo electrónico no válido"]'
     data-nombre='@Localizer["El nombre solo debe contener letras"]'
     data-apellido='@Localizer["El apellido solo debe contener letras"]'
     data-tel='@Localizer["Número de teléfono no válido"]'>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
